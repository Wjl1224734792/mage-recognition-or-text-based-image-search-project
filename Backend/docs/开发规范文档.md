# 开发规范文档

## 1. 引言

### 1.1 规范目的
本规范旨在建立统一的开发标准，提升代码质量、可维护性和团队协作效率，为项目长期健康发展奠定基础。

### 1.2 适用范围
- 前端JavaScript/TypeScript项目
- Node.js后端服务项目
- 全栈应用开发

### 1.3 核心原则
- **一致性**：统一的技术栈和编码风格
- **语义化**：清晰的命名和职责划分
- **简洁性**：避免过度设计，保持代码简洁
- **可扩展性**：支持功能平滑演进
- **分层明确**：关注点分离，职责清晰

## 2. 代码质量保障

### 2.1 代码格式化规范 (Prettier)

#### 统一配置
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "endOfLine": "lf",
  "arrowParens": "avoid"
}
```

#### 集成方案
- **ESLint协作**：使用`eslint-config-prettier`避免规则冲突
- **Git Hooks**：通过husky在pre-commit阶段自动格式化
- **编辑器支持**：VS Code保存时自动格式化

### 2.2 代码质量规范 (ESLint)

#### 核心规则配置
```javascript
export default {
  env: {
    node: true,
    es2021: true
  },
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'prettier'
  ],
  rules: {
    '@typescript-eslint/no-explicit-any': 'warn',
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-unused-vars': 'error',
    'prefer-const': 'error'
  }
}
```

#### 质量策略
- **严格类型检查**：TypeScript严格模式
- **错误处理规范**：统一的异常处理机制
- **导入优化**：自动排序和清理未使用导入
- **渐进采用**：支持通过注释临时禁用规则

## 3. 版本控制规范

### 3.1 分支管理策略

#### 分支架构
```
main                    # 主干分支 - 生产环境
├── develop             # 开发分支 - 功能集成
│   ├── feature/*      # 功能分支
│   ├── hotfix/*       # 紧急修复
│   └── experiment/*   # 实验性分支
└── release/*          # 发布分支
```

#### 分支命名规范
| 类型     | 格式                        | 示例                         | 说明       |
| -------- | --------------------------- | ---------------------------- | ---------- |
| 功能分支 | `feature/YYYYMMDD_功能描述` | `feature/20231201_user_auth` | 新功能开发 |
| 修复分支 | `hotfix/YYYYMMDD_问题描述`  | `hotfix/20231202_login_bug`  | 紧急修复   |
| 发布分支 | `release/版本号`            | `release/v1.2.0`             | 版本发布   |
| 文档分支 | `docs/文档主题`             | `docs/api_reference`         | 文档更新   |

### 3.2 提交信息规范

#### 标准格式
```
<类型>[可选范围]: <描述>

[可选正文]

[可选脚注]
```

#### 提交类型
| 类型       | 描述     | 示例                            |
| ---------- | -------- | ------------------------------- |
| `feat`     | 新功能   | `feat(auth): 添加用户登录`      |
| `fix`      | bug修复  | `fix(login): 修复登录错误`      |
| `docs`     | 文档更新 | `docs(api): 更新API文档`        |
| `refactor` | 代码重构 | `refactor(utils): 重构工具函数` |
| `test`     | 测试相关 | `test(user): 添加用户测试`      |

#### 自动化检查
```javascript
// commitlint.config.js
export default {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [2, 'always', ['feat', 'fix', 'docs', 'style', 'refactor', 'test', 'chore']]
  }
};
```

## 4. 架构设计规范

### 4.1 分层架构设计

#### 核心业务层
- **路由层 (Routes)**：API端点定义
- **处理层 (Handlers)**：请求生命周期管理
- **服务层 (Services)**：核心业务逻辑
- **数据访问层 (Data Access)**：统一数据接口

#### 基础设施层
- **数据库层 (Database)**：数据持久化
- **验证层 (Validation)**：数据校验
- **中间件层 (Middleware)**：横切关注点
- **工具层 (Utilities)**：通用能力
- **配置层 (Configuration)**：环境配置

### 4.2 目录结构规范
```
src/
├── config/           # 应用配置
├── routes/           # 路由定义
├── handlers/         # 请求处理
├── services/         # 业务服务
├── data/            # 数据访问
├── middleware/       # 中间件
├── schemas/         # 数据验证
├── utils/           # 工具函数
└── app.js           # 应用入口
```

## 5. 编码规范

### 5.1 命名规范

#### 文件命名
- 路由定义：`[资源].routes.js`
- 业务服务：`[资源].service.js`
- 数据访问：`[资源].data.js`
- 中间件：`[功能].middleware.js`

#### 代码元素
- **变量**：小驼峰 `userName`
- **常量**：全大写蛇形 `MAX_USERS`
- **函数**：动词短语 `getUserProfile`
- **类**：大驼峰 `UserService`

### 5.2 模块规范

#### 默认导出
```javascript
// services/user.service.js
class UserService {
  async createUser(userData) {
    // 业务逻辑
  }
}

export default UserService;
```

#### 命名导出
```javascript
// utils/validation.util.js
export const isValidEmail = (email) => {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};

export const validationRules = {
  email: isValidEmail
};
```

### 5.3 类型定义 (JSDoc)

#### 服务层类型
```javascript
/**
 * @typedef {Object} User
 * @property {string} id - 用户ID
 * @property {string} name - 用户名
 * @property {string} email - 邮箱
 */

class UserService {
  /**
   * 创建用户
   * @param {CreateUserData} userData - 用户数据
   * @returns {Promise<User>} 创建的用户
   */
  async create(userData) {
    // 实现逻辑
  }
}
```

## 6. API设计规范

### 6.1 资源导向设计
- **资源标识**：复数名词，连字符连接
- **操作表达**：HTTP方法体现意图
- **状态管理**：专用端点，保持幂等性

### 6.2 响应标准
```javascript
// 成功响应
{
  "success": true,
  "data": {...},
  "message": "操作成功"
}

// 错误响应
{
  "success": false,
  "message": "错误描述",
  "errors": [...]
}
```

## 7. 数据库设计规范

### 7.1 数据建模
- **表命名**：复数形式，蛇形命名
- **字段命名**：蛇形命名，避免保留字
- **关系设计**：通过命名体现关系类型

### 7.2 操作规范
- **查询封装**：复杂逻辑封装为方法
- **事务管理**：跨表操作使用事务
- **性能优化**：关键字段建立索引

## 8. 协作流程规范

### 8.1 代码合并流程
1. **分支保护**：main、develop分支设置保护
2. **代码审查**：至少1名核心成员审查
3. **Rebase操作**：合并前rebase到目标分支
4. **CI/CD检查**：通过所有自动化检查
5. **提交历史**：保持线性清晰历史

### 8.2 Git Hooks集成
```json
{
  "husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS",
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{js,ts}": ["eslint --fix", "prettier --write"],
    "*.{json,md}": ["prettier --write"]
  }
}
```

## 9. 维护与演进

### 9.1 日常维护
- **功能扩展**：遵循现有架构体系
- **组件废弃**：明确标记，提供迁移路径
- **技术债务**：定期评估和重构

### 9.2 规范演进
- **渐进改进**：考虑现有代码兼容性
- **变更沟通**：重大变更需团队评审
- **文档同步**：规范更新及时反映

## 10. 总结

本规范通过建立统一的技术标准和协作流程，为团队开发提供完整的指导框架：

- **降低认知成本**：一致的代码风格和架构模式
- **提升协作效率**：清晰的流程和标准
- **保障代码质量**：自动化检查和代码审查
- **支持长期演进**：可扩展的架构设计

规范应根据具体项目需求进行调整，但需确保团队范围内的一致性和可执行性。

---
*最后更新日期: 2025年10月21日*
*文档版本: v1.0*